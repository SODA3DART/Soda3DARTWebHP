<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGPU 3Dギャラリー - 崇城大学芸術学部美術学科 3Dアートコース</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans JP', sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            overflow: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ヘッダースタイル */
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }

        .logo-text span {
            display: block;
            font-size: 14px;
            color: #777;
            font-weight: 400;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 30px;
        }

        nav ul li a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
            position: relative;
            padding-bottom: 5px;
        }

        nav ul li a:after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            background: #4285f4;
            bottom: 0;
            left: 0;
            transition: width 0.3s;
        }

        nav ul li a:hover {
            color: #4285f4;
        }

        nav ul li a:hover:after {
            width: 100%;
        }

        .mobile-menu {
            display: none;
            cursor: pointer;
        }

        /* WebGPU Canvas */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* UI Overlay */
        .ui-overlay {
            position: fixed;
            top: 80px;
            left: 20px;
            z-index: 100;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 300px;
        }

        .ui-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #333;
        }

        .ui-description {
            font-size: 0.9rem;
            margin-bottom: 15px;
            color: #555;
        }

        .ui-controls {
            margin-top: 15px;
        }

        .ui-controls p {
            font-size: 0.85rem;
            margin-bottom: 5px;
            color: #666;
        }

        /* Loading Indicator */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
        }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4285f4;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* WebGPU Not Supported Message */
        #not-supported {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
            padding: 20px;
            text-align: center;
        }

        #not-supported h2 {
            color: #d32f2f;
            margin-bottom: 20px;
        }

        #not-supported p {
            max-width: 600px;
            margin-bottom: 15px;
        }

        /* レスポンシブ対応 */
        @media (max-width: 768px) {
            .header-container {
                padding: 15px;
            }

            .logo-text {
                font-size: 16px;
            }

            .logo-text span {
                font-size: 12px;
            }

            nav {
                position: fixed;
                top: 80px;
                left: 0;
                width: 100%;
                background-color: #fff;
                padding: 20px;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
                transform: translateY(-150%);
                transition: transform 0.3s;
                z-index: 999;
            }

            nav.active {
                transform: translateY(0);
            }

            nav ul {
                flex-direction: column;
            }

            nav ul li {
                margin: 10px 0;
            }

            .mobile-menu {
                display: block;
            }

            .ui-overlay {
                top: auto;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- ヘッダー -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <div class="logo-text">崇城大学 芸術学部<span>3Dアートコース</span></div>
            </div>
            <div class="mobile-menu" id="mobileMenu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 12H21" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 6H21" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 18H21" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <nav id="nav">
                <ul>
                    <li><a href="../../index.html">ホーム</a></li>
                    <li><a href="../../index.html#features">コース紹介</a></li>
                    <li><a href="../../gallery.html">ギャラリー</a></li>
                    <li><a href="../../index.html#news">ニュース</a></li>
                    <li><a href="../../index.html#contact">お問い合わせ</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- WebGPU Canvas -->
    <div id="canvas-container">
        <canvas id="webgpu-canvas"></canvas>
    </div>

    <!-- UI Overlay -->
    <div class="ui-overlay">
        <h2 class="ui-title">WebGPU 3Dアートギャラリー</h2>
        <p class="ui-description">最新のWebGPU技術を使用した3Dモデル表示です。Edge、Chromeなどの最新ブラウザでWebGPUを有効にして表示できます。</p>
        <div class="ui-controls">
            <p>左クリック + ドラッグ: モデルを回転</p>
            <p>マウスホイール: ズームイン/アウト</p>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading">
        <div class="spinner"></div>
        <p>読み込み中...</p>
    </div>

    <!-- WebGPU Not Supported Message -->
    <div id="not-supported">
        <h2>WebGPUがサポートされていません</h2>
        <p>お使いのブラウザはWebGPUをサポートしていないか、WebGPUが有効になっていません。</p>
        <p>最新のChrome、Edge、またはFirefoxを使用して、WebGPUを有効にしてください。</p>
        <p>Chrome/Edgeの場合: chrome://flags または edge://flags で「WebGPU」を検索して有効にしてください。</p>
        <p id="error-details" style="color: #d32f2f; margin-top: 15px; font-weight: bold;"></p>
        <p>ローカル環境で実行している場合は、Webサーバーを使用して表示することをお勧めします。</p>
        <p>例: Visual Studio CodeのLive Server拡張機能や、Python SimpleHTTPServerなど</p>
    </div>

    <script type="module">
        // WebGPUのサポートチェック
        if (!navigator.gpu) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('not-supported').style.display = 'flex';
            document.getElementById('error-details').textContent = 'エラー: このブラウザはWebGPUをサポートしていません。';
            console.error('WebGPU is not supported on this browser.');
            throw new Error('WebGPU is not supported on this browser.');
        }

        // プロトコルチェック - WebGPUはHTTPSまたはlocalhostが必要
        const isSecureContext = window.isSecureContext;
        const isLocalhost = window.location.hostname === 'localhost' ||
                           window.location.hostname === '127.0.0.1' ||
                           window.location.protocol === 'file:';

        console.log('Security context check:', {
            isSecureContext,
            isLocalhost,
            protocol: window.location.protocol,
            hostname: window.location.hostname
        });

        if (!isSecureContext && !isLocalhost) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('not-supported').style.display = 'flex';
            document.getElementById('error-details').textContent = 'エラー: WebGPUはHTTPS接続またはローカルホスト環境が必要です。';
            throw new Error('WebGPU requires a secure context (HTTPS) or localhost.');
        }

        // 初期化関数
        async function init() {
            // キャンバスの設定
            const canvas = document.getElementById('webgpu-canvas');
            const devicePixelRatio = window.devicePixelRatio || 1;
            canvas.width = canvas.clientWidth * devicePixelRatio;
            canvas.height = canvas.clientHeight * devicePixelRatio;

            // アダプタの要求
            let adapter;
            try {
                console.log('Requesting WebGPU adapter...');
                adapter = await navigator.gpu.requestAdapter({
                    powerPreference: 'high-performance'
                });

                if (!adapter) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('not-supported').style.display = 'flex';
                    document.getElementById('error-details').textContent = 'エラー: 適切なGPUアダプタが見つかりませんでした。';
                    console.error('No appropriate GPUAdapter found.');
                    throw new Error('No appropriate GPUAdapter found.');
                }

                console.log('WebGPU adapter info:', {
                    name: await adapter.requestAdapterInfo().then(info => info.adapter || 'Unknown'),
                    vendor: await adapter.requestAdapterInfo().then(info => info.vendor || 'Unknown'),
                    architecture: await adapter.requestAdapterInfo().then(info => info.architecture || 'Unknown'),
                    device: await adapter.requestAdapterInfo().then(info => info.device || 'Unknown'),
                    description: await adapter.requestAdapterInfo().then(info => info.description || 'Unknown')
                });
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('not-supported').style.display = 'flex';
                document.getElementById('error-details').textContent = `エラー: アダプタの要求中にエラーが発生しました: ${error.message}`;
                console.error('Error requesting adapter:', error);
                throw error;
            }

            // デバイスの要求
            let device;
            try {
                console.log('Requesting WebGPU device...');
                device = await adapter.requestDevice({
                    requiredFeatures: [],
                    requiredLimits: {}
                });
                console.log('WebGPU device obtained successfully');
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('not-supported').style.display = 'flex';
                document.getElementById('error-details').textContent = `エラー: デバイスの要求中にエラーが発生しました: ${error.message}`;
                console.error('Error requesting device:', error);
                throw error;
            }

            // キャンバスコンテキストの設定
            let context;
            try {
                console.log('Setting up WebGPU canvas context...');
                context = canvas.getContext('webgpu');
                if (!context) {
                    throw new Error('Failed to get WebGPU context from canvas');
                }

                const presentationFormat = navigator.gpu.getPreferredCanvasFormat();
                console.log('Preferred canvas format:', presentationFormat);

                context.configure({
                    device,
                    format: presentationFormat,
                    alphaMode: 'premultiplied',
                });
                console.log('Canvas context configured successfully');
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('not-supported').style.display = 'flex';
                document.getElementById('error-details').textContent = `エラー: キャンバスコンテキストの設定中にエラーが発生しました: ${error.message}`;
                console.error('Error configuring canvas context:', error);
                throw error;
            }

            // 深度テクスチャの作成
            let depthTexture = device.createTexture({
                size: [canvas.width, canvas.height],
                format: 'depth24plus',
                usage: GPUTextureUsage.RENDER_ATTACHMENT
            });

            // シェーダーコード
            const shaderCode = `
                struct Uniforms {
                    modelViewProjection : mat4x4<f32>,
                };

                @group(0) @binding(0) var<uniform> uniforms : Uniforms;

                struct VertexOutput {
                    @builtin(position) position : vec4<f32>,
                    @location(0) color : vec4<f32>,
                };

                @vertex
                fn vertexMain(@location(0) position : vec3<f32>,
                              @location(1) color : vec4<f32>) -> VertexOutput {
                    var output : VertexOutput;
                    output.position = uniforms.modelViewProjection * vec4<f32>(position, 1.0);
                    output.color = color;
                    return output;
                }

                @fragment
                fn fragmentMain(@location(0) color : vec4<f32>) -> @location(0) vec4<f32> {
                    return color;
                }
            `;

            // シェーダーモジュールの作成
            const shaderModule = device.createShaderModule({
                label: 'Basic shader',
                code: shaderCode
            });

            // 頂点バッファの作成 - キューブの頂点データ
            const vertices = new Float32Array([
                // 前面 (z=0.5)
                -0.5, -0.5,  0.5,  1.0, 0.0, 0.0, 1.0, // 左下, 赤
                 0.5, -0.5,  0.5,  1.0, 0.0, 0.0, 1.0, // 右下, 赤
                 0.5,  0.5,  0.5,  1.0, 0.0, 0.0, 1.0, // 右上, 赤
                -0.5,  0.5,  0.5,  1.0, 0.0, 0.0, 1.0, // 左上, 赤

                // 背面 (z=-0.5)
                -0.5, -0.5, -0.5,  0.0, 1.0, 0.0, 1.0, // 左下, 緑
                -0.5,  0.5, -0.5,  0.0, 1.0, 0.0, 1.0, // 左上, 緑
                 0.5,  0.5, -0.5,  0.0, 1.0, 0.0, 1.0, // 右上, 緑
                 0.5, -0.5, -0.5,  0.0, 1.0, 0.0, 1.0, // 右下, 緑

                // 上面 (y=0.5)
                -0.5,  0.5, -0.5,  0.0, 0.0, 1.0, 1.0, // 左前, 青
                -0.5,  0.5,  0.5,  0.0, 0.0, 1.0, 1.0, // 左後, 青
                 0.5,  0.5,  0.5,  0.0, 0.0, 1.0, 1.0, // 右後, 青
                 0.5,  0.5, -0.5,  0.0, 0.0, 1.0, 1.0, // 右前, 青

                // 下面 (y=-0.5)
                -0.5, -0.5, -0.5,  1.0, 1.0, 0.0, 1.0, // 左前, 黄
                 0.5, -0.5, -0.5,  1.0, 1.0, 0.0, 1.0, // 右前, 黄
                 0.5, -0.5,  0.5,  1.0, 1.0, 0.0, 1.0, // 右後, 黄
                -0.5, -0.5,  0.5,  1.0, 1.0, 0.0, 1.0, // 左後, 黄

                // 右面 (x=0.5)
                 0.5, -0.5, -0.5,  0.0, 1.0, 1.0, 1.0, // 左下, シアン
                 0.5,  0.5, -0.5,  0.0, 1.0, 1.0, 1.0, // 左上, シアン
                 0.5,  0.5,  0.5,  0.0, 1.0, 1.0, 1.0, // 右上, シアン
                 0.5, -0.5,  0.5,  0.0, 1.0, 1.0, 1.0, // 右下, シアン

                // 左面 (x=-0.5)
                -0.5, -0.5, -0.5,  1.0, 0.0, 1.0, 1.0, // 右下, マゼンタ
                -0.5, -0.5,  0.5,  1.0, 0.0, 1.0, 1.0, // 左下, マゼンタ
                -0.5,  0.5,  0.5,  1.0, 0.0, 1.0, 1.0, // 左上, マゼンタ
                -0.5,  0.5, -0.5,  1.0, 0.0, 1.0, 1.0  // 右上, マゼンタ
            ]);

            const vertexBuffer = device.createBuffer({
                size: vertices.byteLength,
                usage: GPUBufferUsage.VERTEX,
                mappedAtCreation: true
            });
            new Float32Array(vertexBuffer.getMappedRange()).set(vertices);
            vertexBuffer.unmap();

            // ユニフォームバッファの作成
            const uniformBufferSize = 4 * 4 * 4; // 4x4 matrix
            const uniformBuffer = device.createBuffer({
                size: uniformBufferSize,
                usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST
            });

            // バインドグループレイアウトの作成
            const bindGroupLayout = device.createBindGroupLayout({
                entries: [
                    {
                        binding: 0,
                        visibility: GPUShaderStage.VERTEX,
                        buffer: { type: 'uniform' }
                    }
                ]
            });

            // バインドグループの作成
            const bindGroup = device.createBindGroup({
                layout: bindGroupLayout,
                entries: [
                    {
                        binding: 0,
                        resource: { buffer: uniformBuffer }
                    }
                ]
            });

            // パイプラインの作成
            const pipeline = device.createRenderPipeline({
                layout: device.createPipelineLayout({
                    bindGroupLayouts: [bindGroupLayout]
                }),
                vertex: {
                    module: shaderModule,
                    entryPoint: 'vertexMain',
                    buffers: [
                        {
                            arrayStride: 7 * 4, // 3 (position) + 4 (color) = 7 floats
                            attributes: [
                                { shaderLocation: 0, offset: 0, format: 'float32x3' },  // position
                                { shaderLocation: 1, offset: 3 * 4, format: 'float32x4' }  // color
                            ]
                        }
                    ]
                },
                fragment: {
                    module: shaderModule,
                    entryPoint: 'fragmentMain',
                    targets: [{ format: presentationFormat }]
                },
                primitive: {
                    topology: 'triangle-list',
                    cullMode: 'back'  // 背面カリングを有効化
                },
                depthStencil: {
                    format: 'depth24plus',
                    depthWriteEnabled: true,
                    depthCompare: 'less'
                }
            });

            // モデル回転用の変数
            let rotation = 0;

            // リサイズハンドラ
            window.addEventListener('resize', () => {
                const devicePixelRatio = window.devicePixelRatio || 1;
                canvas.width = canvas.clientWidth * devicePixelRatio;
                canvas.height = canvas.clientHeight * devicePixelRatio;

                // 深度テクスチャの再作成
                depthTexture.destroy();
                depthTexture = device.createTexture({
                    size: [canvas.width, canvas.height],
                    format: 'depth24plus',
                    usage: GPUTextureUsage.RENDER_ATTACHMENT
                });
            });

            // ホイールイベントでズーム
            let zoomLevel = 3.0;
            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                zoomLevel += e.deltaY * 0.005;
                zoomLevel = Math.max(1.5, Math.min(10, zoomLevel));
            });

            // マウスイベントのハンドリング
            let mouseDown = false;
            let lastMouseX = 0;
            let rotationSpeed = 0;

            canvas.addEventListener('mousedown', (e) => {
                mouseDown = true;
                lastMouseX = e.clientX;
                rotationSpeed = 0;
            });

            canvas.addEventListener('mouseup', () => {
                mouseDown = false;
            });

            canvas.addEventListener('mousemove', (e) => {
                if (mouseDown) {
                    const deltaX = e.clientX - lastMouseX;
                    rotationSpeed = deltaX * 0.01;
                    lastMouseX = e.clientX;
                }
            });

            // 行列計算用のヘルパー関数
            function createModelViewProjection(aspectRatio, rotation) {
                // X軸とY軸の両方の回転を含む行列計算
                const cosX = Math.cos(rotation * 0.5);
                const sinX = Math.sin(rotation * 0.5);
                const cosY = Math.cos(rotation);
                const sinY = Math.sin(rotation);

                const modelMatrix = new Float32Array([
                    cosY, 0, sinY, 0,
                    sinY * sinX, cosX, -cosY * sinX, 0,
                    -sinY * cosX, sinX, cosY * cosX, 0,
                    0, 0, 0, 1
                ]);

                const viewMatrix = new Float32Array([
                    1, 0, 0, 0,
                    0, 1, 0, 0,
                    0, 0, 1, 0,
                    0, 0, -zoomLevel, 1  // ズームレベルに応じてカメラ位置を調整
                ]);

                const projectionMatrix = new Float32Array([
                    1 / aspectRatio, 0, 0, 0,
                    0, 1, 0, 0,
                    0, 0, 0.5, 0,
                    0, 0, 0.5, 1
                ]);

                // 行列の乗算（簡易的な実装）
                const mvpMatrix = new Float32Array(16);
                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        let sum = 0;
                        for (let k = 0; k < 4; k++) {
                            sum += modelMatrix[i * 4 + k] * viewMatrix[k * 4 + j];
                        }
                        mvpMatrix[i * 4 + j] = sum;
                    }
                }

                const result = new Float32Array(16);
                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        let sum = 0;
                        for (let k = 0; k < 4; k++) {
                            sum += mvpMatrix[i * 4 + k] * projectionMatrix[k * 4 + j];
                        }
                        result[i * 4 + j] = sum;
                    }
                }

                return result;
            }

            // インデックスバッファの作成
            const indices = new Uint16Array([
                // 前面
                0, 1, 2, 2, 3, 0,
                // 背面
                4, 5, 6, 6, 7, 4,
                // 上面
                8, 9, 10, 10, 11, 8,
                // 下面
                12, 13, 14, 14, 15, 12,
                // 右面
                16, 17, 18, 18, 19, 16,
                // 左面
                20, 21, 22, 22, 23, 20
            ]);

            const indexBuffer = device.createBuffer({
                size: indices.byteLength,
                usage: GPUBufferUsage.INDEX,
                mappedAtCreation: true
            });
            new Uint16Array(indexBuffer.getMappedRange()).set(indices);
            indexBuffer.unmap();

            // レンダリングループ
            function render() {
                // 自動回転
                if (!mouseDown) {
                    rotation += 0.01;
                } else {
                    rotation += rotationSpeed;
                }

                // 行列の計算
                const aspect = canvas.width / canvas.height;
                const mvpMatrix = createModelViewProjection(aspect, rotation);

                // ユニフォームバッファの更新
                device.queue.writeBuffer(
                    uniformBuffer,
                    0,
                    mvpMatrix.buffer,
                    mvpMatrix.byteOffset,
                    mvpMatrix.byteLength
                );

                // レンダーパスの設定
                const commandEncoder = device.createCommandEncoder();
                const renderPass = commandEncoder.beginRenderPass({
                    colorAttachments: [
                        {
                            view: context.getCurrentTexture().createView(),
                            clearValue: { r: 0.1, g: 0.1, b: 0.1, a: 1.0 },
                            loadOp: 'clear',
                            storeOp: 'store'
                        }
                    ],
                    depthStencilAttachment: {
                        view: depthTexture.createView(),
                        depthClearValue: 1.0,
                        depthLoadOp: 'clear',
                        depthStoreOp: 'store'
                    }
                });

                // 描画コマンドの設定
                renderPass.setPipeline(pipeline);
                renderPass.setBindGroup(0, bindGroup);
                renderPass.setVertexBuffer(0, vertexBuffer);
                renderPass.setIndexBuffer(indexBuffer, 'uint16');
                renderPass.drawIndexed(36); // インデックス数
                renderPass.end();

                // コマンドの実行
                device.queue.submit([commandEncoder.finish()]);

                // 次のフレームの要求
                requestAnimationFrame(render);
            }

            // ローディング表示を非表示にする
            document.getElementById('loading').style.display = 'none';

            // レンダリングループの開始
            requestAnimationFrame(render);
        }

        // 初期化の実行
        init().catch(error => {
            console.error('Initialization failed:', error);
            document.getElementById('loading').style.display = 'none';
            document.getElementById('not-supported').style.display = 'flex';

            // エラー詳細が設定されていない場合は一般的なエラーメッセージを表示
            const errorDetails = document.getElementById('error-details');
            if (!errorDetails.textContent) {
                errorDetails.textContent = `エラー: WebGPUの初期化に失敗しました: ${error.message}`;
            }

            // ファイルプロトコルで実行されている場合は特別なメッセージを表示
            if (window.location.protocol === 'file:') {
                const fileProtocolWarning = document.createElement('p');
                fileProtocolWarning.style.color = '#d32f2f';
                fileProtocolWarning.style.fontWeight = 'bold';
                fileProtocolWarning.textContent = 'ファイルプロトコル(file://)で実行されています。WebGPUはWebサーバー経由でアクセスする必要があります。';
                document.getElementById('not-supported').appendChild(fileProtocolWarning);

                // 簡易サーバーの起動方法を表示
                const serverInstructions = document.createElement('div');
                serverInstructions.innerHTML = `
                    <h3 style="margin-top: 20px;">ローカルWebサーバーの起動方法:</h3>
                    <p><strong>Python を使用する場合:</strong></p>
                    <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto;">
# Python 3
python -m http.server

# Python 2
python -m SimpleHTTPServer
                    </pre>
                    <p><strong>Node.js を使用する場合:</strong></p>
                    <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto;">
# グローバルにインストール
npm install -g http-server
http-server
                    </pre>
                    <p>サーバーを起動したら、ブラウザで <a href="http://localhost:8000">http://localhost:8000</a> にアクセスしてください。</p>
                `;
                document.getElementById('not-supported').appendChild(serverInstructions);
            }
        });

        // モバイルメニュートグル
        const mobileMenu = document.getElementById('mobileMenu');
        const nav = document.getElementById('nav');

        mobileMenu.addEventListener('click', function() {
            nav.classList.toggle('active');
        });
    </script>
</body>
</html>
